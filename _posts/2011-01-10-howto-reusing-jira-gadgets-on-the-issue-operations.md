---
layout: post
title: "HowTo: Reusing JIRA gadgets on the issue operations"
date: "2011-01-10"
comments: false
permalink: 2011/01/howto-reusing-jira-gadgets-on-issue_10.html

---

Hi everybody,<br /><br /><span class="Apple-style-span" style="font-size: large;">Problem description</span><br />Recently I had to&nbsp;implement&nbsp;the following use case:<br /><br /><ul><li>Customer has very strict defined issue creation policy and wants to control the every bit of issue creation (things like enhanced priority etc support).</li><li>The main focus is on usability and rich user interface support.</li><li>Basically it's <b>multi-step</b>&nbsp;procedure.</li></ul><div>After reviewing customer requirements it was decided to go with custom <a href="http://www.atlassian.com/software/jira/tour/opensocial-dashboards.jsp">Dashboard Open Social Gadgets</a>.</div><div><br /></div><div>So the initial solution mockup looked like that:</div><div class="separator" style="clear: both; text-align: left;"><a href="http://2.bp.blogspot.com/_Y9XTlNGJRTQ/TSs3vAI5F_I/AAAAAAAAEGo/t7KYGj-pxLY/s1600/wizard1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="217" src="http://2.bp.blogspot.com/_Y9XTlNGJRTQ/TSs3vAI5F_I/AAAAAAAAEGo/t7KYGj-pxLY/s400/wizard1.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">The wizard-gadget itself was tricky to implement as well, but's an another story.</div><div class="separator" style="clear: both; text-align: left;">For the sake of this article let's consider that we already have out plugin implemented with the REST &nbsp;services to create / update, read issue data.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><span class="Apple-style-span" style="font-size: large;">Transforming gadget to it an Issue operation</span></div><div class="separator" style="clear: both; text-align: left;">At some complicated updates are required from the user interface.We want to <b>reuse</b>&nbsp;the wizard created previously. The way I decided to proceed is to implement issue operation. So, that does it mean for end user? See the mockup below:</div><div class="separator" style="clear: both; text-align: left;"><a href="http://2.bp.blogspot.com/_Y9XTlNGJRTQ/TSs522EooNI/AAAAAAAAEGs/QXDDPVzZOKo/s1600/wizard2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="248" src="http://2.bp.blogspot.com/_Y9XTlNGJRTQ/TSs522EooNI/AAAAAAAAEGs/QXDDPVzZOKo/s400/wizard2.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">But! Jira does not provide this kind of functionality. So, we need to implement this on out own.</div><div class="separator" style="clear: both; text-align: left;">First of all we will create our own issue operation (useful information <a href="http://confluence.atlassian.com/display/JIRA/Web+Fragments">web-fragments</a>, <a href="http://confluence.atlassian.com/display/JIRA/Updating+JIRA+Plugins+for+JIRA+4.1#UpdatingJIRAPluginsforJIRA4.1-IssueOperationmoduletypeisnolongeravailable">updating jira plugins for jira 4.1</a>).&nbsp;</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><b>1. </b>See the atlassian-plugin.xml snippet for that</div><script src="https://gist.github.com/773063.js?file=issue-operation-snippet.xml"></script><br /><div class="separator" style="clear: both; text-align: left;">So, we have implemented new Issue Operation which will open web-work action page we have not defined yet so far. Let's do so.</div><div class="separator" style="clear: both; text-align: left;"><b>2.</b> See action code.</div><script src="https://gist.github.com/773088.js?file=MyWebAction.java"></script><br /><div class="separator" style="clear: both; text-align: left;"><b>3. </b>As you may see, <i>MyWebAction</i> depends on&nbsp;<span class="Apple-style-span" style="font-family: 'Bitstream Vera Sans Mono', Courier, monospace; font-size: 12px; line-height: 16px; white-space: pre;"><span class="n" style="line-height: 1.4em; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px;">GadgetRequestContextFactory</span></span><span class="Apple-style-span" style="font-family: 'Bitstream Vera Sans Mono', Courier, monospace; font-size: 12px; line-height: 16px; white-space: pre;"> and </span><span class="Apple-style-span" style="font-family: 'Bitstream Vera Sans Mono', Courier, monospace; font-size: 12px; line-height: 16px; white-space: pre;">GadgetViewFactory</span><span class="Apple-style-span" style="font-family: inherit;"><span class="Apple-style-span" style="font-size: 12px; line-height: 16px; white-space: pre;"> </span><span class="Apple-style-span" style="line-height: 16px; white-space: pre;">which are OSGi components, so you should import them as component dependencies.</span></span></div><script src="https://gist.github.com/773100.js?file=component-import-snippet.xml"></script><br /><div class="separator" style="clear: both; text-align: left;"><span class="Apple-style-span" style="line-height: 16px; white-space: pre;"><b>4.</b> Let's add add web-action definition to attlasian-plugin.xml</span></div><script src="https://gist.github.com/773113.js?file=mywebaction-atlassian-plugin.xml"></script><br /><div class="separator" style="clear: both; text-align: left;"><span class="Apple-style-span" style="line-height: 16px; white-space: pre;"><b>5.</b>  Lets specify&nbsp;</span><span class="Apple-style-span" style="font-family: 'Bitstream Vera Sans Mono', Courier, monospace; font-size: 12px; line-height: 16px; white-space: pre;"><i>/templates/mywebaction/render.vm</i> </span><span class="Apple-style-span" style="line-height: 16px; white-space: pre;">template.</span></div><script src="https://gist.github.com/773138.js?file=render.vm"></script><br /><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">And we are finally done. Note&nbsp;<span class="Apple-style-span" style="font-family: 'Bitstream Vera Sans Mono', Courier, monospace; font-size: 12px; line-height: 16px; white-space: pre;"><i>xx.yy.zz.arguments.issueId</i> </span>javascript assignment.&nbsp;It's done to pass in arguments to gadget instance.&nbsp;</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><b>6.</b> The following code could be used to get the overall idea:</div><script src="https://gist.github.com/773145.js?file=gadget-load-issue-data-snippet.js"></script><br /><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><span class="Apple-style-span" style="font-size: large;">Implementing issue operations the&nbsp;Jira&nbsp;way - using&nbsp;AJS&nbsp;popup&nbsp;dialogs</span></div><div class="separator" style="clear: both; text-align: left;">At this stage you have working and complete issue-gadget-operation. Cool? Yeah!</div><div class="separator" style="clear: both; text-align: left;">anyway, purists would argue that it's not inline with Jira Look&amp;Feel. At the moment it does open as separate action, which is not inline with the rest of issue operation actions.</div><div class="separator" style="clear: both; text-align: left;">Basically we want our action too look like that (in the popup dialog as all the other actions):</div><div class="separator" style="clear: both; text-align: left;"><a href="http://4.bp.blogspot.com/_Y9XTlNGJRTQ/TStKNB9teyI/AAAAAAAAEGw/VTx9jS28uZw/s1600/wizard3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="317" src="http://4.bp.blogspot.com/_Y9XTlNGJRTQ/TStKNB9teyI/AAAAAAAAEGw/VTx9jS28uZw/s400/wizard3.png" width="400" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Is it possible? Yes, it is.</div><div class="separator" style="clear: both; text-align: left;">To make our wizard to appear as popup dialog box we need to include some javascript to browse issue page. The easiest way to do so is via servlet filter.</div><div class="separator" style="clear: both; text-align: left;"><span class="Apple-style-span" style="font-family: inherit;"><b><br /></b></span></div><div class="separator" style="clear: both; text-align: left;"><span class="Apple-style-span" style="font-family: inherit;"><b>1. </b>See atlassian-plugin.xml snippet for defining the servlet filter and javascript resource.</span></div><div class="separator" style="clear: both; text-align: left;"><script src="https://gist.github.com/773162.js?file=resources-snippet.xml"></script></div><span class="Apple-style-span" style="font-family: inherit;"><b><br /></b></span><br /><span class="Apple-style-span" style="font-family: inherit;"><b>2.</b>&nbsp;See the filter definition itself</span><br /><script src="https://gist.github.com/773173.js?file=IncludeResourcesFilter.java"></script><br /><span class="Apple-style-span" style="font-family: inherit;"><b><br /></b></span><br /><span class="Apple-style-span" style="font-family: inherit;"><b>3.</b>&nbsp;And the AJS javascript magic itself</span><br /><script src="https://gist.github.com/773182.js?file=xxx-yyy.js"></script><br /><br />And finally, all the pieces are tight together and you have Jira-AJS-POPUP style issue operation. And the cool part is - it reuses gadget instance created previously.<br /><div class="separator" style="clear: both; text-align: left;"><span class="Apple-style-span" style="font-family: inherit;"><br /></span></div><div class="separator" style="clear: both; text-align: left;"><span class="Apple-style-span" style="font-family: inherit;">Hopefully you will find this stuff useful.&nbsp;</span></div>
