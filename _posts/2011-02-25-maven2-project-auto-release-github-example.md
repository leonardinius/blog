---
layout: post
title: Maven2 project auto-release [@GitHub] example
date: 2011-02-25
comments: false
permalink: 2011/02/maven2-project-license-check-and-auto.html

---

What's about?
---
So, I finally got my head around&nbsp;<a href="http://maven.apache.org/plugins/maven-release-plugin/index.html">maven-release-plugin</a>&nbsp;maven plugin.&nbsp;And, yes, it's awesome.<br />I have not tried any kind of different/difficult scenarios yet, just plain basic ones.

So, what I wanted to achieve in the first place?
---
- G1 - maven artifact auto-versioning on build success
  <br />1.1-SNAPSHOT on master branch/TRUNK&nbsp;gets promoted to 1.1 maven release, at the same time master/TRUNK becomes 1.2-SNAPSHOT
- G2 - some kind of tagging/branching on build success
  <br />G1 support on CVS level via tags/branches
- G3 - maven artifact deployment (from CVS repository to maven repository)
- G4 - ability to launch it from CI tool

Visually that could be depicted in the following way:
<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-fbfXjYrNXKI/TWbxumA8D-I/AAAAAAAAEJo/EIHRJxBmTPM/s1600/branching.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://4.bp.blogspot.com/-fbfXjYrNXKI/TWbxumA8D-I/AAAAAAAAEJo/EIHRJxBmTPM/s1600/branching.png" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Branching [<a href="http://wiki.obiba.org/display/ONYX/Onyx+Branches,+Tags+and+Releases">source</a>]</td></tr></tbody></table>
All the goals accomplished. Yada-ya-da!

Ok, enough reading. Gimme the code
See&nbsp;<a href="https://github.com/leonardinius/test-maven-release">test-maven-release</a>&nbsp;Github project

How-to?
---
* <b>G1, G2</b> - are accomplished by <a href="http://maven.apache.org/plugins/maven-release-plugin/prepare-mojo.html">release:prepare</a>&nbsp;goal.<br /><b> Input needed:</b> scm info<br />
<b>Input example:</b>
<pre><code class="xml">&lt;scm&gt;<br />  &lt;connection&gt;<br />     scm:git:git://github.com/leonardinius/test-maven-release.git<br />  &lt;/connection&gt;<br />  &lt;developerConnection&gt;<br />     scm:git:ssh://git@github.com/leonardinius/test-maven-release.git<br />  &lt;/developerConnection&gt;<br />  &lt;url&gt;<br />     https://github.com/leonardinius/test-maven-release<br />  &lt;/url&gt;<br />&lt;/scm&gt;<br /></code></pre>Execution sample:<br /><pre><code class="no-highlight"><br />prusax:test-maven-release leonidmaslov$ mvn release:clean release:prepare<br />[INFO] Scanning for projects...<br />[INFO] Searching repository for plugin with prefix: 'release'.<br />[INFO] ------------------------------------------------------------------------<br />[INFO] Building test-maven-release<br />[INFO]    task-segment: [release:clean, release:prepare] (aggregator-style)<br />[INFO] ------------------------------------------------------------------------<br />[INFO] [release:clean]<br />[INFO] Cleaning up after release...<br />[INFO] [release:prepare]<br />[INFO] Verifying that there are no local modifications...<br />[INFO] Executing: /bin/sh -c cd /Users/leonidmaslov/Documents/workspace/test-maven-release &amp;&amp; git status<br />[INFO] Working directory: /Users/leonidmaslov/Documents/workspace/test-maven-release<br />[INFO] Checking dependencies and plugins for snapshots ...<br />What is the release version for "test-maven-release"? (leonardinius-test:test-maven-release) 1.0: : <br />What is SCM release tag or label for "test-maven-release"? (leonardinius-test:test-maven-release) test-maven-release-1.0: : myTag<br />What is the new development version for "test-maven-release"? (leonardinius-test:test-maven-release) 1.1-SNAPSHOT: : <br />[INFO] Transforming 'test-maven-release'...<br />[INFO] Not generating release POMs<br />[INFO] Executing goals 'clean verify'...<br />[WARNING] Maven will be executed in interactive mode, but no input stream has been configured for this MavenInvoker instance.<br />[INFO] [INFO] Scanning for projects...<br />[INFO] [INFO] ------------------------------------------------------------------------<br />[INFO] [INFO] Building test-maven-release<br />[INFO] [INFO]    task-segment: [clean, verify]<br />[INFO] [INFO] ------------------------------------------------------------------------<br />[INFO] [INFO] [clean:clean]<br />[INFO] [INFO] [resources:resources]<br />[INFO] [WARNING] Using platform encoding (MacRoman actually) to copy filtered resources, i.e. build is platform dependent!<br />[INFO] [INFO] skip non existing resourceDirectory /Users/leonidmaslov/Documents/workspace/test-maven-release/src/main/resources<br />[INFO] [INFO] [compiler:compile]<br />[INFO] [INFO] Compiling 1 source file to /Users/leonidmaslov/Documents/workspace/test-maven-release/target/classes<br />[INFO] [INFO] [resources:testResources]<br />[INFO] [WARNING] Using platform encoding (MacRoman actually) to copy filtered resources, i.e. build is platform dependent!<br />[INFO] [INFO] Copying 1 resource<br />[INFO] [INFO] [compiler:testCompile]<br />[INFO] [INFO] Compiling 1 source file to /Users/leonidmaslov/Documents/workspace/test-maven-release/target/test-classes<br />[INFO] [INFO] [surefire:test]<br />[INFO] [INFO] Surefire report directory: /Users/leonidmaslov/Documents/workspace/test-maven-release/target/surefire-reports<br />[INFO] <br />[INFO] -------------------------------------------------------<br />[INFO]  T E S T S<br />[INFO] -------------------------------------------------------<br />[INFO] Running me.doautomate.ExampleServletTest<br />[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.024 sec<br />[INFO] <br />[INFO] Results :<br />[INFO] <br />[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0<br />[INFO] <br />[INFO] [INFO] [jar:jar]<br />[INFO] [INFO] Building jar: /Users/leonidmaslov/Documents/workspace/test-maven-release/target/test-maven-release-1.0.jar<br />[INFO] [INFO] ------------------------------------------------------------------------<br />[INFO] [INFO] BUILD SUCCESSFUL<br />[INFO] [INFO] ------------------------------------------------------------------------<br />[INFO] [INFO] Total time: 3 seconds<br />[INFO] [INFO] Finished at: Thu Feb 24 22:02:49 CET 2011<br />[INFO] [INFO] Final Memory: 22M/81M<br />[INFO] [INFO] ------------------------------------------------------------------------<br />[INFO] Checking in modified POMs...<br />[INFO] Executing: /bin/sh -c cd /Users/leonidmaslov/Documents/workspace/test-maven-release &amp;&amp; git add pom.xml<br />[INFO] Working directory: /Users/leonidmaslov/Documents/workspace/test-maven-release<br />[INFO] Executing: /bin/sh -c cd /Users/leonidmaslov/Documents/workspace/test-maven-release &amp;&amp; git status<br />[INFO] Working directory: /Users/leonidmaslov/Documents/workspace/test-maven-release<br />[INFO] Executing: /bin/sh -c cd /Users/leonidmaslov/Documents/workspace/test-maven-release &amp;&amp; git commit --verbose -F /var/folders/IA/IA2V6NfrE84m+Fcb-LJguU+++TI/-Tmp-/maven-scm-811668125.commit pom.xml<br />[INFO] Working directory: /Users/leonidmaslov/Documents/workspace/test-maven-release<br />[INFO] Executing: /bin/sh -c cd /Users/leonidmaslov/Documents/workspace/test-maven-release &amp;&amp; git push<br />[INFO] Working directory: /Users/leonidmaslov/Documents/workspace/test-maven-release<br />[INFO] Tagging release with the label myTag...<br />[INFO] Executing: /bin/sh -c cd /Users/leonidmaslov/Documents/workspace/test-maven-release &amp;&amp; git tag -F /var/folders/IA/IA2V6NfrE84m+Fcb-LJguU+++TI/-Tmp-/maven-scm-1676785108.commit myTag<br />[INFO] Working directory: /Users/leonidmaslov/Documents/workspace/test-maven-release<br />[INFO] Executing: /bin/sh -c cd /Users/leonidmaslov/Documents/workspace/test-maven-release &amp;&amp; git push origin myTag<br />[INFO] Working directory: /Users/leonidmaslov/Documents/workspace/test-maven-release<br />[INFO] Executing: /bin/sh -c cd /Users/leonidmaslov/Documents/workspace/test-maven-release &amp;&amp; git ls-files<br />[INFO] Working directory: /Users/leonidmaslov/Documents/workspace/test-maven-release<br />[INFO] Transforming 'test-maven-release'...<br />[INFO] Not removing release POMs<br />[INFO] Checking in modified POMs...<br />[INFO] Executing: /bin/sh -c cd /Users/leonidmaslov/Documents/workspace/test-maven-release &amp;&amp; git add pom.xml<br />[INFO] Working directory: /Users/leonidmaslov/Documents/workspace/test-maven-release<br />[INFO] Executing: /bin/sh -c cd /Users/leonidmaslov/Documents/workspace/test-maven-release &amp;&amp; git status<br />[INFO] Working directory: /Users/leonidmaslov/Documents/workspace/test-maven-release<br />[INFO] Executing: /bin/sh -c cd /Users/leonidmaslov/Documents/workspace/test-maven-release &amp;&amp; git commit --verbose -F /var/folders/IA/IA2V6NfrE84m+Fcb-LJguU+++TI/-Tmp-/maven-scm-1157159798.commit pom.xml<br />[INFO] Working directory: /Users/leonidmaslov/Documents/workspace/test-maven-release<br />[INFO] Executing: /bin/sh -c cd /Users/leonidmaslov/Documents/workspace/test-maven-release &amp;&amp; git push<br />[INFO] Working directory: /Users/leonidmaslov/Documents/workspace/test-maven-release<br />[INFO] Release preparation complete.<br />[INFO] ------------------------------------------------------------------------<br />[INFO] BUILD SUCCESSFUL<br />[INFO] ------------------------------------------------------------------------<br />[INFO] Total time: 1 minute <br />[INFO] Finished at: Thu Feb 24 22:02:59 CET 2011<br />[INFO] Final Memory: 14M/81M<br />[INFO] ------------------------------------------------------------------------<br />prusax:test-maven-release leonidmaslov$ <br /></code></pre><br /></li><li><b>G3</b> - is accomplished by <a href="http://maven.apache.org/plugins/maven-release-plugin/perform-mojo.html">release:perform</a>&nbsp;plugin. The plugin checkouts the tag/branch from the CVS system, builds it and deploys to maven repository.<br /><b>NB: </b>relies on <i style="text-decoration: underline;">release:prepare</i>&nbsp;being called first (needs release.properties file).<br /><b> Input needed:</b> scm info, distribution management<br /><b>Input example:</b><br /><pre><code class="xml">&lt;scm&gt;<br />    &lt;connection&gt;<br />      scm:git:git://github.com/leonardinius/test-maven-release.git<br />    &lt;/connection&gt;<br />    &lt;developerConnection&gt;<br />      scm:git:ssh://git@github.com/leonardinius/test-maven-release.git<br />    &lt;/developerConnection&gt;<br />    &lt;url&gt;https://github.com/leonardinius/test-maven-release&lt;/url&gt;<br />&lt;/scm&gt;<br /><br />&lt;distributionManagement&gt;<br />    &lt;site&gt;<br />        &lt;id&gt;site-id&lt;/id&gt;<br />        &lt;name&gt;site-name&lt;/name&gt;<br />        &lt;url&gt;scp://host/path/to/repository/&lt;/url&gt;<br />    &lt;/site&gt;<br />    &lt;repository&gt;<br />        &lt;id&gt;repo-main&lt;/id&gt;<br />        &lt;name&gt;Repository Name&lt;/name&gt;<br />        &lt;url&gt;file://tmp/&lt;/url&gt;<br />    &lt;/repository&gt;<br />    &lt;!-- use the following if you ARE using a snapshot version. --&gt;<br />    &lt;snapshotRepository&gt;<br />        &lt;id&gt;repo-snapshot&lt;/id&gt;<br />        &lt;name&gt;Repository Name&lt;/name&gt;<br />        &lt;url&gt;file://tmp/&lt;/url&gt;<br />    &lt;/snapshotRepository&gt;<br />&lt;/distributionManagement&gt;<br /></code></pre><br /></li><li><b>G4</b>&nbsp;is accomplished by launching maven in the batch mode.<br /><b>Example:</b><br /><pre><code>mvn clean --batch-mode  release:prepare release:perform</code></pre>

Conclusion
---
Adding automated maven project versioning is not so hard and could be easily automated.
